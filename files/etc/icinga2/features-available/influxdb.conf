{% set settings = salt['mc_icinga2.settings']() %}
{% set s = settings.modules.influxdb %}
object InfluxdbWriter "influxdb" {
    host = "{{s.host}}"
    port = {{s.port}}
    database = "{{s.database.name}}"
    username = "{{s.database.username}}"
    password = "{{s.database.password}}"
    enable_send_thresholds = true
    enable_send_metadata = true
    host_template = {
      measurement = "$host.check_command$"
      tags = {
        hostname = "$host.name$"
      }
    }
    service_template = {
      measurement = "$service.check_command$"
      tags = {
        hostname = "$host.name$"
        service = "$service.name$"
      }
  }
}
